# 花苗流程自动化开发计划（更新版）

更新日期：2026-02-01

## 当前实现状态（POC）
- 手机端单页 SPA 已完成（拆分/合并、上架、状态、转移）
- Express + lowdb 后端已完成
- 登录鉴权已完成（/api/login + Bearer Token）
- 事件日志 + “我的录入历史”已完成
- 真实扫码/打印尚未接入

## 目标
在不改变核心操作习惯的前提下，用“扫码记录动作”替代纸笔/回录；先手机上线，后续可无缝扩展扫码枪与手持终端。

## 范围与边界
### 包含
- 预印二维标签 + 位置码的扫码流程
- plant_id / dish_id 分离与转移事件
- 拆分/合并、批量上架、状态巡查、换皿转移
- 事件日志驱动的统计与绩效基础

### 不包含（本阶段）
- 硬件选型/采购决策
- 高级统计建模与预测
- 复杂权限/多组织协作

## 里程碑与阶段任务

### Phase 1：需求冻结与规则定义（MVP 范围）
- 确认状态枚举与初始字段集
- 确认标签尺寸/短码长度/容错
- 确定批量扫“结束动作”规则（按钮/超时）
- 明确父子关系与合并/拆分的计数逻辑

### Phase 2：数据模型与事件日志
- ERD 设计（plant/dish/event/location/staff）
- 事件一致性规则（父→子、旧→新）
- 转移事件与 dish 退役规则
- 标签库存状态（未用/已用/作废）

### Phase 3：MVP 扫码流程（手机优先）
- 创建/拆分/合并：父一次 + 多子连扫
- 上架/摆放：位置一次 + 多皿连扫
- 状态更新：单扫 + 状态按钮
- 换皿/转移：旧皿→新皿
- 撤销最近 1–3 步

### Phase 4：后台基础与报表骨架
- 事件查询与导出
- 基础绩效统计（拆分/合并数量、操作人、时间）
- 异常检测（重复扫、无效标签、顺序错误）

### Phase 5：试点上线与迭代
- 小范围试点（1–2 人，1–2 批次）
- 记录问题并改交互/规则
- 形成操作 SOP 与培训材料

### Phase 6：设备扩展准备
- 扫码枪/PDA 兼容性验证
- 同一流程多设备输入适配

## 验收标准（MVP）
- 拆分/合并全程无需纸笔回录
- 父子关系自动维护且可追溯
- 位置记录可批量上架完成
- 换皿转移可完整追溯 dish 生命周期
- 操作员学习成本低（1 小时内能独立完成）

## 风险与缓解
- 扫码顺序错误 → 强校验 + 最近撤销
- 标签贴错/损坏 → 转移事件 + 作废标签
- 批量流程卡顿 → 位置与拆分解耦、批量扫码

## 待确认清单（阻塞项）
- 标签尺寸与短码规范
- 批量扫“结束动作”机制
- 状态枚举清单（感染/变异…）

