# FLA 花苗流程管理系统 — UX 重新规划方案

> 版本：2.0 | 更新日期：2026-02-12

---

## 1. 用户角色与使用场景

### 1.1 操作员（operator）日常高频操作

操作员是系统的主要使用者，日常工作围绕培养间/温室进行，手持手机或平板，一手拿设备一手操作。

**高频操作排序**（按日常频率从高到低）：

| 排序 | 操作 | 场景描述 | 频率 |
|------|------|----------|------|
| 1 | 状态更新 | 巡检时逐皿扫码记录健康状态（正常/感染/变异） | 每日多次 |
| 2 | 上架 | 处理完培养皿后放回货架，需记录位置 | 每日多次 |
| 3 | 拆分 | 培养达标后拆分子代，一次操作生成多皿 | 每日数次 |
| 4 | 创建（入库） | 新苗入库，批量创建花苗和培养皿 | 每日数次 |
| 5 | 转移（换皿） | 培养皿损坏或需更换时操作 | 偶尔 |
| 6 | 合并 | 将多株合为一株，操作较复杂 | 偶尔 |
| 7 | 撤销 | 误操作后的补救 | 罕见 |

**典型工作流（一天）**：
1. 早间：巡检所有货架，扫码更新花苗状态 → **批量状态更新**是核心痛点
2. 上午：处理拆分任务，拆分后上架 → **拆分 + 上架**经常连续执行
3. 下午：新苗入库创建 + 上架 → **创建 + 上架**经常连续执行
4. 不定时：换皿、合并等低频操作

### 1.2 管理员（admin）特有场景

- 标签打印：批量生成二维码标签，用于新盘子/新货架标识
- 用户管理：查看用户列表（目前功能有限）
- 数据审计：查看全部事件日志，追踪操作历史

### 1.3 当前 UX 痛点分析

| 编号 | 痛点 | 严重程度 | 说明 |
|------|------|----------|------|
| P1 | 创建/拆分/合并挤在一个 Tab 里 | 高 | 通过下拉框切换模式，认知负担大，容易选错模式 |
| P2 | 状态更新不支持批量操作 | 高 | 巡检场景下需逐皿提交，效率极低 |
| P3 | 上架流程不够流畅 | 中 | 位置锁定后添加盘子，但提交后队列清空，需重新操作 |
| P4 | Tab 文字标签无图标 | 中 | 底部导航只有文字，不符合移动端操作习惯 |
| P5 | 撤销按钮位于 header 右上角 | 中 | 位置不直觉，且没有操作预览 |
| P6 | 事件历史占据大量滚动空间 | 中 | 两个历史区域（我的+全部）在主界面底部，挤占操作空间 |
| P7 | 无操作成功后的引导 | 中 | 提交成功后只有 toast，缺少"下一步"引导 |
| P8 | header 信息过杂 | 低 | 标签链接、用户名、退出、撤销挤在一行 |
| P9 | 扫码入口不够醒目 | 中 | 扫码按钮样式与普通按钮区分不大 |
| P10 | 缺少库存总览 | 高 | 操作员无法快速了解当前花苗总量和分布 |

---

## 2. 信息架构重新设计

### 2.1 新 Tab/页面结构

将现有 4 个 Tab 重新规划为 **5 个底部 Tab**，并调整功能归属：

```
底部导航栏（5 个 Tab）
┌──────────┬──────────┬──────────┬──────────┬──────────┐
│  总览    │  扫码    │  操作    │  历史    │  更多    │
│ 首页概览  │ 快捷扫码  │ 全部操作  │ 事件记录  │ 设置工具  │
└──────────┴──────────┴──────────┴──────────┴──────────┘
```

**Tab 详细规划：**

#### Tab 1：总览（首页）
- 显示核心统计数据：花苗总数、各状态分布、今日操作数
- 快捷操作入口（常用操作的大按钮卡片）
- 最近 5 条操作记录预览
- 登录用户信息

#### Tab 2：扫码（核心操作入口）
- 默认打开摄像头，扫码后自动识别目标类型（培养皿 D-、盘子 T-、位置 rack-）
- 根据扫码结果智能跳转到对应操作界面
- 连续扫码模式按钮
- 这是操作员最常用的入口，一扫即用

#### Tab 3：操作
- 所有操作类型以卡片列表展示（不再用下拉切换）
- 每个操作类型独立页面：创建、拆分、合并、上架、状态、转移
- 支持从此处手动进入各操作（非扫码场景）

#### Tab 4：历史
- 整合"我的录入历史"和"事件日志"为一个带切换的页面
- Tab 内顶部切换：我的记录 / 全部记录
- 筛选器：按类型、按日期范围
- 从主界面移走历史区域，释放操作空间

#### Tab 5：更多
- 标签打印（内嵌，不再需要跳转 admin.html）
- 用户信息与退出
- 撤销最近操作（带预览）
- 管理员专属功能（用户管理等）

### 2.2 页面层级

```
首页（总览）
├── 扫码 → 智能跳转
│   ├── 扫到培养皿 → 状态更新 / 转移 / 拆分（选择操作）
│   ├── 扫到盘子 → 上架
│   └── 扫到位置 → 上架（自动锁定位置）
├── 操作
│   ├── 创建（入库）
│   ├── 拆分
│   ├── 合并
│   ├── 上架
│   ├── 状态更新（支持批量）
│   └── 转移
├── 历史
│   ├── 我的记录
│   └── 全部记录
└── 更多
    ├── 标签打印
    ├── 撤销操作
    ├── 用户信息
    └── 管理员功能
```

### 2.3 导航策略

- **底部 Tab 栏**：5 个主导航，图标 + 文字，固定底部
- **页面内返回**：操作详情页面顶部有返回按钮，返回上一级
- **扫码全局入口**：底部 Tab 中间位置放扫码（视觉突出），同时每个操作页面内也保留单独的扫码按钮
- **面包屑**：操作子页面显示路径（操作 > 创建）

---

## 3. 每个功能模块的交互流程

### 3.1 创建（入库）

**用户操作步骤**：
1. 进入"操作 > 创建"页面
2. 选择品种（下拉框，品种A/品种B）
3. 选择阶段（下拉框，萌发/生长/分化）
4. 输入数量（数字步进器，范围 1-50，默认 3）
5. 输入/扫码盘子编号（如 T-01）
6. 点击"确认创建"

**输入方式**：
- 品种/阶段：下拉选择，支持记住上次选择（localStorage）
- 数量：数字输入 + 快捷按钮（1、3、5、10）
- 盘子编号：扫码（优先）或手动输入，带快捷选择已有盘子列表

**反馈方式**：
- 提交中：按钮变灰显示"创建中..."
- 成功：全屏成功卡片，显示"成功创建 N 株花苗"，列出所有新培养皿编号（D-xx ~ D-xx），提供"继续创建"和"去上架"两个下一步按钮
- 失败：红色 toast + 具体错误信息，表单保留已填数据

**批量优化**：
- 创建后提供"再创建一批（相同设置）"快捷按钮
- 盘子编号自动建议下一个可用编号

### 3.2 拆分

**用户操作步骤**：
1. 进入"操作 > 拆分"或扫码培养皿后选择"拆分"
2. 输入/确认父培养皿 ID（如 D-1）
3. 显示父培养皿信息卡片（品种、阶段、当前状态）
4. 输入/扫码盘子编号
5. 输入拆分数量（数字步进器，范围 1-50，默认 3）
6. 点击"确认拆分"

**输入方式**：
- 父培养皿 ID：扫码（优先）或手动输入
- 盘子编号：扫码或手动输入
- 数量：数字输入 + 快捷按钮

**反馈方式**：
- 扫码后立即显示父培养皿信息确认卡片（品种、阶段），若不存在则红色提示
- 成功：全屏成功卡片，显示"拆分 D-1 → N 株子代"，列出新编号，提供"继续拆分"和"去上架"
- 失败：红色 toast，保留表单数据

**批量优化**：
- 支持"连续拆分"模式：提交后自动清空父皿ID，保持盘子和数量不变，方便连续处理多皿拆分

### 3.3 合并

**用户操作步骤**：
1. 进入"操作 > 合并"
2. 输入/扫码合并后的盘子编号
3. （可选）输入新培养皿编号，或点击"自动生成"
4. 添加父培养皿队列：
   - 方式一：逐一扫码加入（推荐）
   - 方式二：手动输入 + 回车
   - 方式三：粘贴逗号分隔列表
5. 确认队列无误后，点击"确认合并"

**输入方式**：
- 盘子编号：扫码或手动
- 新培养皿编号：手动输入或"自动生成"按钮
- 父培养皿队列：**连续扫码**是核心操作方式
  - 连扫按钮醒目放置
  - 每扫一个显示震动反馈 + 音效提示 + 队列实时更新
  - 重复扫码有明显提示（橙色 toast "D-x 已在队列中"）

**反馈方式**：
- 队列区域实时显示已添加的父皿 chip，每个 chip 可删除
- 队列计数器（已添加 N 皿）
- 成功：显示合并结果
- 失败：保留队列数据

**批量优化**：
- 连续扫码模式优化：摄像头常开，扫码间隔 800ms，重复码 1500ms 冷却
- 父皿 chip 支持长按查看详情

### 3.4 上架

**用户操作步骤**：
1. 进入"操作 > 上架"或扫码位置后自动进入
2. **第一步 — 锁定位置**：
   - 扫码/选择/手输上架位置
   - 位置锁定后显示为固定徽章
3. **第二步 — 添加盘子**：
   - 连续扫码盘子编号（首选方式）
   - 或手动逐一添加
   - 队列实时显示
4. 点击"完成上架"提交

**输入方式**：
- 位置：扫码（优先）、快捷选择列表、手动输入
- 盘子：连续扫码（核心），手动添加为辅

**反馈方式**：
- 位置锁定后，UI 明确变化（位置栏变为固定蓝色徽章，下方区域切换为盘子添加）
- 每添加一个盘子，队列有渐入动画
- 成功：toast "已上架 N 个盘子 @ rack-XX"
- 提供"换位置继续上架"按钮

**批量优化**：
- 上架完成后，不清空位置，提供"继续添加盘子到同一位置"选项
- 支持"换位置"快捷切换，无需重新进入流程

### 3.5 状态更新（重点优化）

**现状痛点**：目前只能逐皿提交状态，巡检效率极低。

**新方案 — 双模式**：

#### 模式一：单皿更新（默认）
1. 扫码/输入培养皿 ID
2. 显示当前花苗信息卡片（品种、阶段、当前状态 — 高亮显示）
3. 选择新状态
4. 点击"更新"

#### 模式二：批量巡检模式（新增）
1. 点击"批量巡检"进入批量模式
2. 选择默认状态（如"正常"）
3. 开启连续扫码
4. 每扫一皿自动以默认状态记录，toast 显示"D-x → 正常"
5. 遇到异常花苗时：
   - 暂停扫码
   - 修改该皿状态为"感染"或"变异"
   - 继续扫码
6. 扫完后显示巡检汇总：总计 N 皿，正常 X，感染 Y，变异 Z
7. 确认提交

**输入方式**：
- 培养皿 ID：扫码为主
- 状态：大按钮选择（三个状态各一个按钮，高亮选中态）

**反馈方式**：
- 扫码后立即显示花苗详情，当前状态醒目标记
- 批量模式下显示进度计数器
- 成功后有确认动画

### 3.6 转移（换皿）

**用户操作步骤**：
1. 进入"操作 > 转移"或扫码旧培养皿后选择"转移"
2. 扫码/输入旧培养皿 ID
3. 显示旧皿花苗信息确认卡片
4. 扫码/输入新培养皿 ID（或点击"自动生成"）
5. 点击"确认转移"

**输入方式**：
- 旧皿 ID：扫码或手动
- 新皿 ID：扫码、手动输入、或"自动生成"按钮

**反馈方式**：
- 旧皿扫码后显示花苗信息确认
- 新皿如果已被占用立即红色提示
- 成功：显示 "D-1 → ND-xx 转移完成"
- 提供"继续转移"按钮

### 3.7 撤销

**重新设计**：从 header 按钮移到"更多"Tab 中的独立界面。

**用户操作步骤**：
1. 进入"更多 > 撤销操作"
2. 显示最近一次操作的详细信息卡片：
   - 操作类型及图标
   - 操作时间
   - 操作内容摘要（涉及的培养皿/花苗 ID）
   - 剩余可撤销时间（5 分钟倒计时）
3. 若超过 5 分钟或无可撤销操作，灰色提示"无可撤销的操作"
4. 点击"确认撤销"后弹出二次确认对话框
5. 确认后执行撤销

**反馈方式**：
- 撤销前显示明确的操作影响预览（"将删除 D-11 ~ D-13 及对应花苗"）
- 成功：绿色确认，自动返回上一页
- 失败：红色错误信息

### 3.8 标签打印

**位置变更**：从独立的 admin.html 页面移到主应用"更多"Tab 内（内嵌页面）。

**用户操作步骤**：
1. 进入"更多 > 标签打印"
2. 选择标签类型（培养皿 D- / 盘子 T- / 位置 rack- / 自定义）
3. 设置起始编号和数量
4. 点击"生成"预览二维码网格
5. 点击"打印"调用浏览器打印

**优化**：
- 预览区域支持缩放
- 打印布局自动适配 A4 纸
- 记住上次打印设置

### 3.9 历史查看

**重新设计**：从主界面底部移到独立的"历史"Tab。

**功能**：
- 顶部 segment 切换：我的记录 / 全部记录
- 筛选栏：类型下拉 + 日期选择器
- 事件列表：每条可展开查看详情
- 下拉刷新
- 无限滚动加载（替代当前限制 20 条）

---

## 4. 移动端体验优化

### 4.1 单手操作友好设计

| 设计要点 | 实施方案 |
|----------|----------|
| 主操作区域集中在屏幕下半部 | 表单输入和提交按钮尽量在屏幕 50% 以下位置 |
| 底部操作栏 | 提交按钮固定在底部 Tab 上方（当前已实现，保持） |
| 大触摸目标 | 所有按钮最小 48x48px（目前 44px，微调） |
| 滑动操作 | 历史记录支持左滑查看详情 |
| 底部弹出选择器 | 下拉选择改为底部弹出的 action sheet 样式 |

### 4.2 扫码流程简化

**当前问题**：扫码是辅助入口，需要先进入对应 Tab 再点击扫码按钮。

**优化方案**：

1. **全局扫码入口**：底部 Tab 栏中央放置扫码按钮（突出显示），点击即开摄像头
2. **智能识别跳转**：
   - 扫到 `D-xx` → 弹出操作选择：状态更新 / 拆分 / 转移
   - 扫到 `T-xx` → 进入上架流程，预填盘子编号
   - 扫到 `rack-xx` → 进入上架流程，自动锁定位置
3. **连续扫码优化**：
   - 扫码成功后震动反馈（已实现，保持）
   - 添加扫码成功音效
   - 连续扫码计数器显示在扫码界面
   - 扫码结果列表实时可见（半屏摄像头 + 半屏列表）
4. **扫码界面改进**：
   - 从全屏覆盖改为半屏滑出（摄像头占上半屏，结果/操作在下半屏）
   - 支持手电筒开关（暗光环境）
   - 扫码框区域显示引导文字（"对准二维码"）

### 4.3 快捷操作设计

1. **总览页快捷卡片**：
   - "快速巡检" → 直接进入批量状态更新
   - "新苗入库" → 直接进入创建
   - "扫码操作" → 打开扫码
2. **操作连续性**：
   - 创建完成后 → "继续创建" / "去上架"
   - 拆分完成后 → "继续拆分" / "去上架"
   - 上架完成后 → "继续上架（同位置）" / "换位置上架"
3. **最近操作快捷重复**：
   - 总览页显示"重复上次操作"按钮（带上次操作摘要）

---

## 5. 视觉设计方向

### 5.1 整体风格建议

**设计语言**：现代、清爽、专业的工具型 UI

- 保持当前的浅色基调，但增强层次感
- 减少圆角半径（当前 16px/18px 偏大），统一为 12px，徽章类保持 999px
- 增加适度的图标使用（底部导航、操作类型标识）
- 卡片层级更清晰：主操作卡片 > 信息展示卡片 > 辅助信息

**参考风格**：类似企业微信/钉钉内部工具的简洁效率感，而非消费级 App 的花哨装饰。

### 5.2 色彩方案方向

保持当前蓝色主色调（sky-500），扩展语义色彩体系：

| 用途 | 色值 | 说明 |
|------|------|------|
| 主色（品牌/操作） | `#0ea5e9` (sky-500) | 保持不变，主要按钮和选中态 |
| 主色悬停 | `#0284c7` (sky-600) | 保持不变 |
| 成功/正常 | `#16a34a` (green-600) | 成功提示，"正常"状态标签 |
| 警告/变异 | `#f59e0b` (amber-500) | "变异"状态标签，注意提示 |
| 危险/感染 | `#ef4444` (red-500) | "感染"状态标签，错误提示，删除操作 |
| 背景 | `#f8fafc` (slate-50) | 页面底色 |
| 卡片 | `#ffffff` | 卡片背景 |
| 主文字 | `#0f172a` (slate-900) | 标题和重要文字 |
| 副文字 | `#64748b` (slate-500) | 说明文字和次要信息 |
| 分隔线 | `#e2e8f0` (slate-200) | 保持不变 |

**状态色彩标签**：
- 正常 → 绿色背景徽章
- 感染 → 红色背景徽章
- 变异 → 橙色背景徽章

### 5.3 组件风格建议

#### 底部 Tab 栏
- 5 栏布局，中间"扫码"按钮视觉突出（略大、圆形、主色背景）
- 每个 Tab 有图标 + 文字
- 选中态：图标和文字变主色，底部有指示条

#### 卡片
- 统一圆角 12px
- 阴影保持当前柔和风格
- 操作类型卡片左侧有彩色边线标识类型

#### 输入框
- 保持当前风格
- 扫码按钮更醒目：添加扫码图标，背景色区分
- 数字输入增加 +/- 步进按钮

#### 按钮
- 主要操作：填充色背钮（蓝色），全宽
- 次要操作：幽灵按钮（边框）
- 危险操作：红色填充
- 快捷选择：pill 样式小按钮

#### Toast 提示
- 成功：绿色背景 + 勾号图标
- 错误：红色背景 + 叉号图标
- 信息：深灰背景
- 位置：从顶部滑入

#### 成功结果页
- 操作成功后显示全屏结果卡片（替代简单 toast）
- 包含：操作摘要 + 结果详情 + 下一步按钮

---

## 6. 错误处理与空状态

### 6.1 错误场景与用户友好提示

| 错误场景 | 当前处理 | 优化方案 |
|----------|----------|----------|
| 培养皿不存在 | toast "培养皿不存在: D-x" | 红色提示卡片，显示"未找到培养皿 D-x，请检查编号是否正确"，并提供"重新扫码"按钮 |
| 新培养皿已被占用 | toast "培养皿已被占用" | 在输入框下方实时显示红色提示"该编号已被使用"，并建议自动生成新编号 |
| 数量超出范围 | toast "数量需大于 0" | 输入框数字约束 + 红色边框 + 提示"请输入 1-50 之间的数字" |
| 网络断开 | toast "当前离线，无法提交" | 顶部红色横幅持续显示"网络已断开"，操作按钮禁用变灰，网络恢复后自动消除 |
| 会话过期（401） | 静默跳转登录页 | 弹出对话框"登录已过期，请重新登录"，点确认后跳转 |
| 服务器错误（500） | toast "请求失败" | 红色卡片显示"服务器处理出错，请稍后再试"，提供"重试"按钮 |
| 撤销超时 | toast "撤销失败" | 撤销页面显示"该操作已超过 5 分钟，无法撤销" |
| 合并父皿重复 | toast "已在队列" | 橙色 toast "D-x 已在队列中"，同时该 chip 短暂闪烁高亮 |
| 登录失败 | "账号或口令错误" | 保持，但增加登录尝试次数提示"请确认账号和口令，连续失败后将暂时锁定" |
| 登录限速（429） | 无特殊处理 | 显示"登录尝试过于频繁，请 1 分钟后再试" |

### 6.2 空状态设计

| 场景 | 空状态展示 |
|------|------------|
| 总览页无数据 | 居中图标 + "暂无花苗数据，点击开始创建" + 创建按钮 |
| 历史记录为空 | 居中图标 + "暂无操作记录" |
| 筛选无结果 | "没有符合筛选条件的记录，试试调整筛选" |
| 上架队列为空 | 淡色提示"扫码或手动添加盘子" |
| 合并父皿队列为空 | 淡色提示"扫码添加要合并的培养皿" |

### 6.3 离线状态处理

**当前实现**：
- 已有离线检测和横幅显示（保持）
- 已有重连后自动刷新（保持）

**优化方案**：
- 离线时所有提交按钮置灰并显示禁用原因
- 离线横幅增加脉冲动画，更醒目
- 网络恢复时显示绿色 toast "网络已恢复"
- 考虑未来版本支持离线队列（操作暂存本地，联网后同步），但当前 POC 阶段不实现

---

## 7. 实施优先级建议

| 优先级 | 改进项 | 影响范围 | 实施复杂度 |
|--------|--------|----------|------------|
| P0 | 信息架构调整（5 Tab 重组） | 全局 | 高 |
| P0 | 批量状态巡检模式 | 状态更新 | 中 |
| P1 | 全局扫码智能识别 | 扫码流程 | 中 |
| P1 | 操作成功后结果页 + 下一步引导 | 全部操作 | 低 |
| P1 | 历史记录独立 Tab | 历史 | 低 |
| P2 | 总览页统计数据 | 首页 | 中 |
| P2 | 扫码界面改为半屏 | 扫码 | 中 |
| P2 | 撤销功能重新设计 | 撤销 | 低 |
| P3 | 底部导航图标 | 导航 | 低 |
| P3 | 标签打印内嵌 | 更多 | 低 |
| P3 | 色彩方案和组件样式统一 | 全局视觉 | 中 |
